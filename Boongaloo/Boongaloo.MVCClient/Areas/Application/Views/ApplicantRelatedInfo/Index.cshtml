@model Boongaloo.MVCClient.Areas.Application.Models.Applicant

@{
    ViewBag.Title = "Index";
}

<h2>Hello, @Model.FirstName @Model.LastName.</h2>
<span>You are an applicant. Please, fill up the additional information.</span>

<form id="additionalInfoForm">
    <input id="add-skill-btn" type="button" value="Add skill"/><br>
    <div id="skills-container" style="border: solid">

    </div>
</form>


<input id="submitButton" type="submit" value="Submit" />

<script type="text/javascript">
    var skillTemplate = 
        '<div>Skill name: <input type="text" name="sname"><br>Skill level: <input type="text" name="slevel"><input class="rem-skill" type="button" value="Remove"></div>';

    $(document)
        .ready(function () {
            $('input#submitButton')
                .click(function () {
                    var dataInfo = { "Skills": [], "Experiences": [], "Educations" : [], "Certificates" : [] };

                    $("#skills-container > div")
                        .each(function(index, element) {
                            var skillName = $(this).find("input[name='sname']").val();
                            var skillLevel = $(this).find("input[name='slevel']").val();

                            dataInfo.Skills.push({ "Name": skillName, "Level": skillLevel });
                        });

                    $.ajax({
                        type: "POST",
                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        url: '/Application/ApplicantRelatedInfo/SubmitAdditionalUserData',
                        data: JSON.stringify(dataInfo), // serializes the form's elements.
                        success: function (data) {
                            alert(data);
                        }
                    });
                });

            // Skills management
            $("#add-skill-btn")
                .on('click',
                    function () {
                        $("#skills-container").append(skillTemplate);
                    });

            $("#skills-container")
                .on("click", ".rem-skill",
                    function () {
                        var $this = $(this);
                        $this.parent().remove();
                    });
        });
</script>